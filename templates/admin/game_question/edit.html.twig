{% extends 'admin/base_admin.html.twig' %}

{% block title %}Modifier la question - Admin{% endblock %}

{% block breadcrumb %}
    <li class="breadcrumb-item"><a href="{{ path('admin_dashboard') }}">Dashboard</a></li>
    <li class="breadcrumb-item"><a href="{{ path('admin_game_index') }}">Games</a></li>
    <li class="breadcrumb-item active">Edit Question</li>
{% endblock %}

{% block header_title %}Modifier la question{% endblock %}

{% block body %}
<div class="main-content">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm p-4" style="border-radius: 12px; background-color: #ffffff;">
                <h2 class="text-center mb-4 text-dark fw-bold">
                    <i class="feather-edit"></i> Modifier la question
                </h2>

                {{ form_start(form, {'attr': {'novalidate': 'novalidate'}}) }}

                <div class="mb-3">
                    {{ form_label(form.questionText, "Texte de la question", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.questionText, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.questionText) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.option1, "Option 1", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.option1, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.option1) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.option2, "Option 2", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.option2, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.option2) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.option3, "Option 3", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.option3, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.option3) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.option4, "Option 4", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.option4, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.option4) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.correctAnswer, "RÃ©ponse correcte", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.correctAnswer, {'attr': {'class': 'form-control', 'placeholder': 'Copiez exactement l\'option correcte'}}) }}
                    {{ form_errors(form.correctAnswer) }}
                </div>

                <div class="mb-3">
                    {{ form_label(form.game, "Jeu associÃ©", {'label_attr': {'class': 'form-label fw-bold'}}) }}
                    {{ form_widget(form.game, {'attr': {'class': 'form-control'}}) }}
                    {{ form_errors(form.game) }}
                </div>

                <div class="text-center mt-4 d-flex gap-2">
                    <button type="submit" class="btn btn-primary w-100 py-2">
                        <i class="feather-save me-1"></i> Enregistrer les modifications
                    </button>
                    <a href="{{ path('admin_game_index') }}" class="btn btn-light w-100 py-2">
                        <i class="feather-x me-1"></i> Annuler
                    </a>
                </div>

                {{ form_end(form) }}

                <div class="text-center mt-3">
                    <button type="button" onclick="openCalculator()" class="btn btn-outline-secondary">
                        ðŸ§® Calculatrice
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Popup Calculatrice -->
<div id="calculatorModal" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 9999;">
    <div class="bg-white p-4 rounded-3 shadow-lg" style="width: 320px;">
        <h5 class="fw-bold mb-3 d-flex justify-content-between">
            Calculatrice
            <button type="button" class="btn-close" onclick="closeCalculator()"></button>
        </h5>
        
        <input type="text" id="calcInput" class="form-control mb-3 text-end fs-4" readonly>
        
        <div class="row g-2 mb-2">
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('7')">7</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('8')">8</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('9')">9</button></div>
            <div class="col-3"><button class="btn btn-warning w-100 font-bold" onclick="appendValue('/')">Ã·</button></div>
        </div>
        <div class="row g-2 mb-2">
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('4')">4</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('5')">5</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('6')">6</button></div>
            <div class="col-3"><button class="btn btn-warning w-100 font-bold" onclick="appendValue('*')">Ã—</button></div>
        </div>
        <div class="row g-2 mb-2">
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('1')">1</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('2')">2</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('3')">3</button></div>
            <div class="col-3"><button class="btn btn-warning w-100 font-bold" onclick="appendValue('-')">-</button></div>
        </div>
        <div class="row g-2 mb-3">
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('0')">0</button></div>
            <div class="col-3"><button class="btn btn-light w-100" onclick="appendValue('.')">.</button></div>
            <div class="col-3"><button class="btn btn-primary w-100 fw-bold" onclick="calculate()">=</button></div>
            <div class="col-3"><button class="btn btn-warning w-100 font-bold" onclick="appendValue('+')">+</button></div>
        </div>
        <div class="row g-2">
            <div class="col-6"><button class="btn btn-danger w-100" onclick="clearCalc()">Effacer</button></div>
            <div class="col-6"><button class="btn btn-secondary w-100" onclick="closeCalculator()">Fermer</button></div>
        </div>
        
        <p id="calcResult" class="mt-3 text-primary fw-bold text-center"></p>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
<script>
    function openCalculator() {
        document.getElementById('calculatorModal').style.display = 'flex';
    }

    function closeCalculator() {
        document.getElementById('calculatorModal').style.display = 'none';
    }

    function appendValue(val) {
        document.getElementById('calcInput').value += val;
    }

    function clearCalc() {
        document.getElementById('calcInput').value = '';
        document.getElementById('calcResult').innerText = '';
    }

    function calculate() {
        try {
            const expr = document.getElementById('calcInput').value;
            const result = math.evaluate(expr);
            document.getElementById('calcResult').innerText = "RÃ©sultat : " + result;
        } catch (e) {
            document.getElementById('calcResult').innerText = "Erreur de calcul";
        }
    }
</script>
{% endblock %}
