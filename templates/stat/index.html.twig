{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-4">
    <h3 class="mb-4">Statistiques Enseignant</h3>

    <div class="row">
 
        <!-- Graphique des scores moyens -->
        <div class="col-md-6">
            <div class="card mb-4">
     

                <div class="card-header text-center">
                    Score moyen par quiz
                </div>
                <div class="card-body" style="height:350px;">
                    <canvas id="scoreChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Graphique des tentatives -->
        <div class="col-md-6">
            <div class="card mb-4">
                <div class="card-header text-center">
                    Nombre de tentatives par quiz
                </div>
                <div class="card-body" style="height:350px;">
                    <canvas id="attemptChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Analyse intelligente cÃ´te Ã  cÃ´te -->
    <div class="row mt-4">
        {% if bestGame and worstGame %}
        <div class="col-md-6">
            <div class="alert alert-info h-100">
                ðŸ“š <strong>Analyse des performances :</strong><br>
                Les Ã©tudiants rÃ©ussissent particuliÃ¨rement bien le quiz <strong>{{ bestGame.titre }}</strong> 
                avec un score moyen de <strong>{{ bestGame.avgScore }}</strong>.  
                Cela montre que la notion abordÃ©e est bien comprise ou que le quiz est clair et adaptÃ©.  

                En revanche, le quiz <strong>{{ worstGame.titre }}</strong> affiche le score moyen le plus faible 
                ({{ worstGame.avgScore }}).  
                Cela peut indiquer que la notion est complexe, que les explications doivent Ãªtre renforcÃ©es, 
                ou que les Ã©tudiants ont besoin de plus de pratique.  

                ðŸ’¡ <em>Recommandation :</em> proposer des exercices supplÃ©mentaires, revoir la formulation des questions 
                ou ajouter un corrigÃ© dÃ©taillÃ© pour <strong>{{ worstGame.titre }}</strong>.
            </div>
        </div>
        {% endif %}

        {% if mostAttempted and leastAttempted %}
        <div class="col-md-6">
            <div class="alert alert-warning h-100">
                ðŸ”Ž <strong>Analyse de lâ€™engagement :</strong><br>
                Le quiz le plus tentÃ© est <strong>{{ mostAttempted.titre }}</strong> 
                avec <strong>{{ mostAttempted.attemptNumber }}</strong> tentatives.  
                Cela traduit un intÃ©rÃªt fort des Ã©tudiants pour ce sujet ou une bonne intÃ©gration dans le parcours.  

                Ã€ lâ€™inverse, le quiz <strong>{{ leastAttempted.titre }}</strong> nâ€™a Ã©tÃ© tentÃ© que 
                <strong>{{ leastAttempted.attemptNumber }}</strong> fois.  
                Cela peut signifier quâ€™il est perÃ§u comme trop difficile, peu motivant ou quâ€™il nâ€™est pas suffisamment mis en avant.  

                ðŸ’¡ <em>Recommandation :</em> encourager les Ã©tudiants Ã  essayer <strong>{{ leastAttempted.titre }}</strong>, 
                par exemple en le reliant Ã  un exercice pratique, en donnant un bonus de participation ou en lâ€™intÃ©grant mieux dans le cours.
            </div>
        </div>
        {% endif %}
    </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const labels = {{ labels|json_encode|raw }};
    const scores = {{ scores|json_encode|raw }};
    const attempts = {{ attempts|json_encode|raw }};

    // Graphique des scores moyens
    new Chart(document.getElementById('scoreChart'), {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Score moyen',
                data: scores,
                backgroundColor: 'rgba(54, 162, 235, 0.6)',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { ticks: { font: { size: 11 }, maxRotation: 0, minRotation: 0 } },
                y: { ticks: { font: { size: 12 } } }
            }
        }
    });

    // Graphique des tentatives
    new Chart(document.getElementById('attemptChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Tentatives',
                data: attempts,
                borderColor: 'rgba(255, 99, 132, 0.8)',
                fill: false,
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { ticks: { font: { size: 11 }, maxRotation: 0, minRotation: 0 } },
                y: { ticks: { font: { size: 12 } } }
            }
        }
    });
</script>
{% endblock %}
