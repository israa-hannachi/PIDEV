{% extends 'base.html.twig' %}

{% block body %}
<div class="container mt-4">
    <h2>Recommandation de Quiz pour l’Enseignant</h2>

    <!-- Formulaire -->
    <form method="get" action="{{ path('app_ques') }}" class="mb-3">
        <label for="lang" class="form-label ms-3">Langue :</label>
        <select name="lang" id="lang" class="form-select w-25 d-inline">
            <option value="en" {% if lang == 'en' %}selected{% endif %}>Anglais</option>
            <option value="fr" {% if lang == 'fr' %}selected{% endif %}>Français</option>
            <option value="es" {% if lang == 'es' %}selected{% endif %}>Espagnol</option>
        </select>

        <label for="category" class="form-label">Choisir une matière et un niveau :</label>
        <select name="category" id="category" class="form-select w-50 d-inline">
            <option value="">Toutes</option>
            <option value="finance-easy" {% if selected == 'finance-easy' %}selected{% endif %}>Finance (Débutant)</option>
            <option value="finance-medium" {% if selected == 'finance-medium' %}selected{% endif %}>Finance (Intermédiaire)</option>
            <option value="java-easy" {% if selected == 'java-easy' %}selected{% endif %}>Java (Débutant)</option>
            <option value="java-medium" {% if selected == 'java-medium' %}selected{% endif %}>Java (Intermédiaire)</option>
            <option value="java-hard" {% if selected == 'java-hard' %}selected{% endif %}>Java (Avancé)</option>
            <option value="mobile-easy" {% if selected == 'mobile-easy' %}selected{% endif %}>Programmation Mobile (Débutant)</option>
            <option value="bd-medium" {% if selected == 'bd-medium' %}selected{% endif %}>Bases de Données (Intermédiaire)</option>
            <option value="ml-hard" {% if selected == 'ml-hard' %}selected{% endif %}>Machine Learning (Avancé)</option>
            <option value="maths-medium" {% if selected == 'maths-medium' %}selected{% endif %}>Mathématiques (Intermédiaire)</option>
        </select>

        <label for="type" class="form-label ms-3">Type de quiz :</label>
        <select name="type" id="type" class="form-select w-25 d-inline">
            <option value="multiple" {% if type == 'multiple' %}selected{% endif %}>Choix multiples</option>
            <option value="boolean" {% if type == 'boolean' %}selected{% endif %}>Vrai / Faux</option>
        </select>

        <button type="submit" class="btn btn-primary ms-3">Afficher</button>
    </form>

    <!-- Disposition en 2 colonnes -->
    <div class="row">
        <!-- Bloc Notes -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-secondary text-white">
                    Bloc Notes - Idées de Questions
                </div>
                <div class="card-body">
                    <textarea id="notesArea" class="form-control" rows="20" placeholder="Écrivez vos idées, pseudo-code ou notes ici..."></textarea>
                </div>
            </div>
        </div>

        <!-- Tableau des questions -->
        <div class="col-md-8">
            {% if questions is not empty %}
                <table class="table table-hover table-striped">
                    <thead class="table-dark">
                        <tr>
                            <th>Question</th>
                            <th>Réponses possibles</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for q in questions %}
                            <tr>
                                <td>{{ q.question|raw }}</td>
                                <td>
                                    {% if q.type == 'boolean' %}
                                        <ul class="list-unstyled">
                                            <li>• Vrai</li>
                                            <li>• Faux</li>
                                        </ul>
                                    {% else %}
                                        {% set answers = q.incorrect_answers|merge([q.correct_answer])|shuffle %}
                                        <ul class="list-unstyled">
                                            {% for answer in answers %}
                                                <li>• {{ answer }}</li>
                                            {% endfor %}
                                        </ul>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p class="text-muted">Aucune question disponible pour cette matière/niveau.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Script pour sauvegarder le bloc notes -->
<script>
    const notesArea = document.getElementById('notesArea');
    // Charger le contenu sauvegardé
    notesArea.value = localStorage.getItem('quizNotes') || '';
    // Sauvegarder à chaque modification
    notesArea.addEventListener('input', () => {
        localStorage.setItem('quizNotes', notesArea.value);
    });
</script>
{% endblock %}
